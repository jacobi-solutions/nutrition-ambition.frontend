<ion-grid *ngIf="hasData" [class.animate]="isVisible">
  <ion-row>
    <!-- Calories Bar Chart -->
    <ion-col size="4.5">
      <div class="chart-wrapper">
        
        <div class="bar-chart">
          <div class="bar-group">
            <span class="target-label" *ngIf="hasTargets">Target: {{ caloriesTarget || 'N/A' }} cal</span>
            <div class="bar ghost-bar" *ngIf="hasTargets"></div>
            <div class="bar consumed-bar" [style.height.%]="caloriesPercentage">
              <span class="bar-value-label">{{ calories }} cal</span>
            </div>
            <span class="bar-label">Calories</span>
          </div>
        </div>
        <div class="bar-label" *ngIf="hasTargets">
          <span *ngIf="caloriesLeft > 0">{{ caloriesLeft | number:'1.0-0' }} cal left</span>
          <span *ngIf="caloriesLeft <= 0">Over target by {{ -caloriesLeft | number:'1.0-0' }} cal</span>
        </div>
        <div class="chart-tip" *ngIf="hasTargets">
          Keep your calories on target to complete the day
        </div>
        <div class="chart-tip" *ngIf="!hasTargets">
          {{ calories | number:'1.0-0' }} cal consumed today
        </div>
        

        <!-- <div class="chart-values">
          <div class="value-item">
            <span class="value-label">Consumed:</span>
            <span class="value-number">{{ calories }} kcal</span>
          </div>
          <div class="value-item" *ngIf="caloriesTarget > 0">
            <span class="value-label">Target:</span>
            <span class="value-number">{{ caloriesTarget }} kcal</span>
          </div>
        </div> -->
      </div>
    </ion-col>

    <!-- Macro Distribution Donut Chart -->
    <ion-col size="7.5">
      <div class="chart-wrapper">
        <div class="donut-chart-container">
          <span class="animation-label targets-label" *ngIf="hasTargets">Targets</span>
          <span class="animation-label actual-label">Actual</span>
          <div class="donut-chart" [style.transform]="'scale(' + donutScale + ')'">
            <svg viewBox="-10 -10 120 120">
            <!-- Single target ring (only if targets exist) -->
            <ng-container *ngIf="hasTargets">
              <circle class="donut-target protein-target" cx="50" cy="50" r="25"
                      [attr.stroke-dasharray]="proteinTargetPercentage * 1.571 + ' ' + 157.1"
                      [attr.stroke-dashoffset]="0"></circle>
              <circle class="donut-target fat-target" cx="50" cy="50" r="25"
                      [attr.stroke-dasharray]="fatTargetPercentage * 1.571 + ' ' + 157.1"
                      [attr.stroke-dashoffset]="-proteinTargetPercentage * 1.571"></circle>
              <circle class="donut-target carbs-target" cx="50" cy="50" r="25"
                      [attr.stroke-dasharray]="carbsTargetPercentage * 1.571 + ' ' + 157.1"
                      [attr.stroke-dashoffset]="-(proteinTargetPercentage + fatTargetPercentage) * 1.571"></circle>
            </ng-container>

            <!-- Actual consumption ring (appears after target) -->
            <circle class="donut-segment protein-segment" cx="50" cy="50" r="30"
                    [attr.stroke-dasharray]="proteinPercentage * 1.885 + ' ' + 188.5"
                    [attr.stroke-dashoffset]="0"></circle>
            <circle class="donut-segment fat-segment" cx="50" cy="50" r="30"
                    [attr.stroke-dasharray]="fatPercentage * 1.885 + ' ' + 188.5"
                    [attr.stroke-dashoffset]="-proteinPercentage * 1.885"></circle>
            <circle class="donut-segment carbs-segment" cx="50" cy="50" r="30"
                    [attr.stroke-dasharray]="carbsPercentage * 1.885 + ' ' + 188.5"
                    [attr.stroke-dashoffset]="-(proteinPercentage + fatPercentage) * 1.885"></circle>

            <!-- Actual percentage labels (white, on middle ring) -->
            <text class="percentage-label protein-label" [attr.x]="proteinLabelX" [attr.y]="proteinLabelY" text-anchor="middle" dominant-baseline="middle" [attr.transform]="'rotate(' + proteinLabelRotation + ', ' + proteinLabelX + ', ' + proteinLabelY + ')'">{{ proteinPercentage }}%</text>
            <text class="percentage-label fat-label" [attr.x]="fatLabelX" [attr.y]="fatLabelY" text-anchor="middle" dominant-baseline="middle" [attr.transform]="'rotate(' + fatLabelRotation + ', ' + fatLabelX + ', ' + fatLabelY + ')'">{{ fatPercentage }}%</text>
            <text class="percentage-label carbs-label" [attr.x]="carbsLabelX" [attr.y]="carbsLabelY" text-anchor="middle" dominant-baseline="middle" [attr.transform]="'rotate(' + carbsLabelRotation + ', ' + carbsLabelX + ', ' + carbsLabelY + ')'">{{ carbsPercentage }}%</text>

            <!-- Target percentage labels (black, outside outer ring) - only if targets exist -->
            <ng-container *ngIf="hasTargets">
              <text class="target-percentage-label protein-target-label" [attr.x]="proteinTargetLabelX" [attr.y]="proteinTargetLabelY" text-anchor="middle" dominant-baseline="central" [attr.transform]="'rotate(' + proteinTargetLabelRotation + ', ' + proteinTargetLabelX + ', ' + proteinTargetLabelY + ')'">{{ proteinTargetPercentage }}%</text>
              <text class="target-percentage-label fat-target-label" [attr.x]="fatTargetLabelX" [attr.y]="fatTargetLabelY" text-anchor="middle" dominant-baseline="central" [attr.transform]="'rotate(' + fatTargetLabelRotation + ', ' + fatTargetLabelX + ', ' + fatTargetLabelY + ')'">{{ fatTargetPercentage }}%</text>
              <text class="target-percentage-label carbs-target-label" [attr.x]="carbsTargetLabelX" [attr.y]="carbsTargetLabelY" text-anchor="middle" dominant-baseline="central" [attr.transform]="'rotate(' + carbsTargetLabelRotation + ', ' + carbsTargetLabelX + ', ' + carbsTargetLabelY + ')'">{{ carbsTargetPercentage }}%</text>
            </ng-container>
          </svg>
          </div>
          <!-- <span class="chart-label">Macros Breakdown</span> -->
          <div class="chart-tip" *ngIf="hasTargets" style="margin-top: 12px; font-size: 10px; color: #A3A3A3; line-height: 1.4; text-align: center;">
            The closer the ring lines up with the pie, the more balanced your day! <br/>
            Ring = Actual, Pie = Target
          </div>
          <div class="chart-tip" *ngIf="!hasTargets" style="margin-top: 12px; font-size: 10px; color: #A3A3A3; line-height: 1.4; text-align: center;">
            Your macronutrient distribution for today
          </div>
        </div>
        <div class="chart-values">
          <div class="value-item">
            <span class="value-dot protein-dot"></span>
            <span class="value-label">Protein:</span>
            <span class="value-number" *ngIf="hasTargets">{{ proteinGrams }}g / {{ proteinTargetGrams }}g</span>
            <span class="value-number" *ngIf="!hasTargets">{{ proteinGrams }}g</span>
          </div>
          <div class="value-item">
            <span class="value-dot fat-dot"></span>
            <span class="value-label">Fat:</span>
            <span class="value-number" *ngIf="hasTargets">{{ fatGrams }}g / {{ fatTargetGrams }}g</span>
            <span class="value-number" *ngIf="!hasTargets">{{ fatGrams }}g</span>
          </div>
          <div class="value-item">
            <span class="value-dot carbs-dot"></span>
            <span class="value-label">Carbs:</span>
            <span class="value-number" *ngIf="hasTargets">{{ carbsGrams }}g / {{ carbsTargetGrams }}g</span>
            <span class="value-number" *ngIf="!hasTargets">{{ carbsGrams }}g</span>
          </div>
        </div>
      </div>
    </ion-col>
  </ion-row>
</ion-grid>

<!-- Empty state -->
<div class="empty-state" *ngIf="!hasData">
  <div class="empty-state-content">
    <ion-icon name="nutrition-outline" class="empty-state-icon"></ion-icon>
    <h2>Nothing logged yet</h2>
    <p>No meals or foods have been logged for this date.</p>
    <p>Head over to the Chat tab to start tracking your macros!</p>
  </div>
</div>
