<div class="debug-layout" (mousemove)="onMouseMove($event)" (mouseup)="onMouseUp()">
    <!-- Left Side: App Replica -->
    <div class="app-replica">
      <div class="replica-header">
        <div class="replica-title">
          <ion-icon name="phone-portrait-outline"></ion-icon>
          User's App View - {{ feedbackWithAccount.accountEmail }}
        </div>
        <div class="replica-version" *ngIf="feedbackWithAccount?.feedback?.createdDateUtc">
          {{ formatDate(feedbackWithAccount.feedback?.createdDateUtc) }}
        </div>
      </div>
      
      <!-- Chat Interface Replica -->
      <div class="chat-replica">
        <div class="chat-header">
          <h2>Chat Messages</h2>
          <span class="message-count">{{ chatMessages.length }} messages</span>
        </div>
        
        <div class="chat-messages-container">
          <div *ngIf="chatMessages.length === 0" class="no-messages">
            <ion-icon name="chatbubbles-outline"></ion-icon>
            <p>No chat messages found</p>
          </div>
          
          <div *ngFor="let message of chatMessages; trackBy: trackByMessageId" 
               class="message-bubble"
               [ngClass]="'message-' + message.role?.toLowerCase()">
            
            <div class="message-header">
              <strong>
                {{ message.role | titlecase }}
              </strong>
              <span class="message-time">{{ formatTime(message.createdDateUtc) }}</span>
              <span *ngIf="message.totalTokens" class="token-tag">
                {{ message.totalTokens }} tokens
              </span>
            </div>
            
            <div class="message-content">
              <p [innerHTML]="formatMessageContent(message.content)"></p>
            </div>

            <!-- Food Selection Details -->
            <div *ngIf="isFoodSelectionMessage(message.role) && message.mealSelections && message.mealSelections[0]" class="food-selection-details">
              <h5>Food Selection Details:</h5>
                <div *ngFor="let foodItem of getFoodSelectionItems(message.mealSelections[0])" class="food-item">
                  <div class="food-header">
                    <strong>{{ foodItem.originalText }}</strong>
                  </div>
                  <div class="food-details">
                    <span class="food-name">{{ foodItem.displayName }}</span>
                    <span *ngIf="foodItem.brandName" class="brand-name">({{ foodItem.brandName }})</span>
                  </div>
                  <div class="serving-info">
                    <span class="quantity">{{ foodItem.displayQuantity }}</span>
                    <span class="unit">{{ foodItem.displayUnit }}</span>
                  </div>
                </div>
            </div>
            
            <div *ngIf="message.totalTokens" class="message-meta">
              <small>{{ message.totalTokens }} tokens</small>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Summary Replica (if user has daily summary) -->
      <div class="summary-replica" *ngIf="userDailyTargets">
        <div class="summary-header">
          <h3>Daily Summary</h3>
          <span class="summary-date">{{ formatDate(selectedDate.toISOString()) }}</span>
        </div>
        <div class="summary-content">
          <p><em>User's daily summary would appear here...</em></p>
        </div>
      </div>
    </div>

    <!-- Resizable Divider -->
    <div class="resize-divider" 
         (mousedown)="onMouseDown($event)"
         title="Drag to resize panels">
      <div class="resize-handle"></div>
      <div class="resize-tooltip">‚ü∑</div>
    </div>

    <!-- Right Side: Debug Context Panels -->
    <div class="debug-panels">
      
      <!-- Top Row: Bug Report Details and User Profile Side by Side -->
      <div class="top-panels-row">
        <!-- Bug Report Details Panel -->
        <div class="debug-panel bug-details">
          <div class="panel-header">
            <div class="panel-title">
              <ion-icon name="bug-outline"></ion-icon>
              <h3>Bug Report Details</h3>
            </div>
            <div class="panel-actions">
              <ion-button
                *ngIf="!feedbackWithAccount?.feedback?.isCompleted"
                size="small"
                color="success"
                fill="outline"
                (click)="markAsComplete()">
                <ion-icon name="checkmark-outline" slot="start"></ion-icon>
                Complete
              </ion-button>
              <ion-button
                *ngIf="feedbackWithAccount?.feedback?.isCompleted"
                size="small"
                color="warning"
                fill="outline"
                (click)="markAsIncomplete()">
                <ion-icon name="refresh-outline" slot="start"></ion-icon>
                Reopen
              </ion-button>
              <ion-button
                size="small"
                color="danger"
                fill="outline"
                (click)="deleteFeedback()">
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Delete
              </ion-button>
            </div>
          </div>
          <div class="panel-content">
            <div class="detail-grid">
              <div class="detail-item">
                <label>Type:</label>
                <ion-badge [color]="getTypeColor(feedbackWithAccount.feedback?.feedbackType!)">
                  {{ feedbackWithAccount.feedback?.feedbackType | titlecase }}
                </ion-badge>
              </div>
              <div class="detail-item">
                <label>Status:</label>
                <ion-badge [color]="feedbackWithAccount.feedback?.isCompleted ? 'success' : 'warning'">
                  {{ feedbackWithAccount.feedback?.isCompleted ? 'Completed' : 'Pending' }}
                </ion-badge>
              </div>
              <div class="detail-item">
                <label>Submitted:</label>
                <span>{{ formatDate(feedbackWithAccount.feedback?.createdDateUtc) }}</span>
              </div>
              <div class="detail-item">
                <label>Feedback ID:</label>
                <code>{{ feedbackWithAccount.feedback?.id || 'Unknown' }}</code>
              </div>
            </div>
            
            <div class="feedback-message">
              <h4>User Message</h4>
              <div class="message-box">{{ feedbackWithAccount.feedback?.message }}</div>
            </div>
            
            <div *ngIf="feedbackWithAccount.feedback?.clientContext || feedbackWithAccount.feedback?.serverContext" class="feedback-context">
              <h4>Context</h4>
              <div class="context-box">
                <div *ngIf="feedbackWithAccount.feedback?.clientContext">
                  <strong>Client Context:</strong> {{ feedbackWithAccount.feedback?.clientContext | json }}
                </div>
                <div *ngIf="feedbackWithAccount.feedback?.serverContext">
                  <strong>Server Context:</strong> {{ feedbackWithAccount.feedback?.serverContext | json }}
                </div>
              </div>
            </div>
            
            <div *ngIf="feedbackWithAccount.feedback?.completionNote" class="completion-note">
              <h4>Admin Notes</h4>
              <div class="note-box">{{ feedbackWithAccount.feedback?.completionNote }}</div>
            </div>
          </div>
        </div>

        <!-- User Profile Panel -->
        <div class="debug-panel user-profile">
          <div class="panel-header">
            <div class="panel-title">
              <ion-icon name="person-outline"></ion-icon>
              <h3>User Profile</h3>
            </div>
          </div>
          <div class="panel-content">
            <div class="profile-grid">
              <div class="profile-item">
                <label>Account ID:</label>
                <code>{{ feedbackWithAccount.accountId }}</code>
              </div>
              <div class="profile-item">
                <label>Email:</label>
                <span>{{ feedbackWithAccount.accountEmail }}</span>
              </div>
              <div class="profile-item">
                <label>Account Created:</label>
                <span>{{ formatDate(feedbackWithAccount.accountCreatedDate) }}</span>
              </div>
            </div>
            
            <!-- User Profile Details (if available) -->
            <div *ngIf="userProfile" class="profile-details">
              <h4>Profile Details</h4>
              <div class="profile-info">
                <p><em>User profile data would be loaded here...</em></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Row: Daily Targets and System Logs -->
      <div class="bottom-panels-row">
        <!-- Daily Targets Panel -->
        <div class="debug-panel daily-targets">
          <div class="panel-header">
            <div class="panel-title">
              <ion-icon name="radio-button-on-outline"></ion-icon>
              <h3>Daily Targets</h3>
            </div>
          </div>
          <div class="panel-content">
            <div *ngIf="!userDailyTargets" class="no-data">
              <p>No daily targets found for this user</p>
            </div>
            <div *ngIf="userDailyTargets" class="targets-info">
              <p><em>Daily targets data would be loaded here...</em></p>
            </div>
          </div>
        </div>

        <!-- System Logs Panel -->
        <div class="debug-panel system-logs">
          <div class="panel-header">
            <div class="panel-title">
              <ion-icon name="terminal-outline"></ion-icon>
              <h3>System Logs</h3>
            </div>
            <div class="panel-actions">
              <ion-button
                size="small"
                fill="outline"
                (click)="loadSystemLogs()">
                <ion-icon name="refresh-outline" slot="start"></ion-icon>
                Refresh
              </ion-button>
            </div>
          </div>
          <div class="panel-content">
            <div *ngIf="logsLoading" class="loading-logs">
              <ion-spinner></ion-spinner>
              <p>Loading system logs...</p>
            </div>
            
            <div *ngIf="!logsLoading && systemLogs.length === 0" class="no-logs">
              <ion-icon name="document-text-outline"></ion-icon>
              <p>No system logs found for this user in the last hour</p>
            </div>
            
            <div *ngIf="!logsLoading && systemLogs.length > 0" class="logs-container">
              <div class="log-entry" *ngFor="let log of systemLogs">
                <span class="log-time">{{ formatTime(log.timestampUtc) }}</span>
                <span class="log-level" [ngClass]="'level-' + log.severity?.toLowerCase()">{{ log.severity }}</span>
                <span class="log-message">{{ log.message }}</span>
                <div *ngIf="log.accountId || log.email || log.traceId" class="log-meta">
                  <span *ngIf="log.accountId" class="meta-item">Account: {{ log.accountId }}</span>
                  <span *ngIf="log.email" class="meta-item">Email: {{ log.email }}</span>
                  <span *ngIf="log.traceId" class="meta-item">Trace: {{ log.traceId }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>