
<!-- Individual Component Item -->
<div *ngIf="component" class="food-item-row-simple" [id]="'row-' + component.componentId" [class.searching]="isSearching">

  <!-- Loading overlay when searching -->
  <div *ngIf="isSearching" class="search-loading-overlay">
    <div class="loading-content">
      <div class="loading-text">{{ component.isNewAddition ? 'Searching for results' : 'Searching for better results' }}</div>
      <div class="typing-indicator-dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </div>
  </div>

  <ion-grid class="row-grid" *ngIf="!isSearching">
    <ion-row class="top-row" align-items-start>
      <ion-col size="1.5" class="photo-col">
        <div class="food-photo">
          <img
            *ngIf="photoThumb"
            [src]="photoThumb"
            [alt]="displayName || 'Food photo'"
            class="food-thumbnail"
            loading="lazy">
          <div
            *ngIf="!photoThumb"
            class="food-thumbnail-placeholder">
            üçΩÔ∏è
          </div>
        </div>
      </ion-col>
      <ion-col size="8.5" class="left">
        <div class="name-section">
          <span class="name">{{ displayName | titlecase}}</span>
          <span *ngIf="isInferred" class="inferred-badge">(inferred)</span>
          <span *ngIf="brandName" class="brand-name"> ‚Äì {{ brandName }}</span>
        </div>
        <div class="serving-line">
          <span class="inline-amount">{{ servingLabel }}</span>
        </div>
      </ion-col>
      <ion-col size="2" class="right" *ngIf="!isReadOnly">
        <div class="action-icons">
          <ion-icon
            [name]="isExpanded ? 'chevron-up-outline' : 'create-outline'"
            class="edit-icon"
            [class.expanded]="isExpanded"
            (click)="onToggleExpansion()">
          </ion-icon>
          <ion-icon
            name="trash-outline"
            class="delete-icon"
            (click)="onRemoveComponent()">
          </ion-icon>
        </div>
      </ion-col>
    </ion-row>
    <ion-row *ngIf="macroSummary" class="macro-row">
      <ion-col size="12">
        <div class="macro-summary">
          {{ macroSummary }}
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>

<!-- Expanded component selection card -->
<div *ngIf="!isReadOnly && isExpanded && !isSearching" class="expanded-food-selection">
  <div class="drilldown-content">
    <div class="food-item-row">
      <div class="food-name">
        <!-- TEMPORARILY DISABLED: Original phrase editing section
        <div class="original-phrase-header">
          <div class="phrase-edit-container" [attr.data-component-id]="component.componentId">
            <div *ngIf="!isEditing" class="phrase-display-mode">
              <strong class="phrase-text">{{ displayName | titlecase}}</strong>
              <span *ngIf="isInferred" class="inferred-badge">(inferred)</span>
              <ion-icon
                name="create-outline"
                class="edit-phrase-icon"
                (click)="onEditStarted()">
              </ion-icon>
            </div>

            <app-search-food
              *ngIf="isEditing"
              [initialPhrase]="originalPhrase"
              placeholder="Describe your food..."
              (phraseSubmitted)="onEditConfirmed($event)"
              (editCanceled)="onEditCanceled()">
            </app-search-food>
          </div>
        </div>
        END TEMPORARILY DISABLED -->
        <div class="food-select-container">
          <app-autocomplete
            [items]="displayMatches"
            bindLabel="displayName"
            [disabled]="isReadOnly"
            [loading]="loadingInstantOptions"
            [searchable]="true"
            [initialSearchText]="displayName"
            [ngModel]="selectedFood"
            (selectionChange)="onFoodSelectedFromAutocomplete($event)"
            (searchChange)="onFoodSearchChange($event)">
          </app-autocomplete>
        </div>

        <!-- More options list -->
        <div *ngIf="showingMoreOptions" class="more-options-list">
          <div class="more-options-header">More options for "{{ originalPhrase }}":</div>
          <ion-list class="more-options-items">
            <ion-item
              *ngFor="let alternative of displayMatches"
              button
              (click)="onMoreOptionSelected(alternative)">
              <ion-label>
                <h3>{{ alternative.displayName }}</h3>
                <p *ngIf="alternative.brandName">{{ alternative.brandName }}</p>
              </ion-label>
            </ion-item>
          </ion-list>
        </div>
      </div>

      <div class="serving-options-inline">
        <!-- Show loading dots when hydrating alternate selection -->
        <div *ngIf="component.isHydratingAlternateSelection">
          <div class="typing-indicator-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>

        <ion-radio-group
          *ngIf="!component.isHydratingAlternateSelection"
          [value]="selectedServingId"
          (ionChange)="onServingSelectedFromRadio($event.detail.value)">
          <ion-radio
            *ngFor="let serving of servingOptions; trackBy: trackByServingId"
            [value]="serving.id"
            [disabled]="isReadOnly"
            (click)="onRowClicked(serving)">
            <div class="serving-row-content" (click)="$event.stopPropagation(); onRowClicked(serving)">
              <!-- Show stepper only for selected row -->
              <ng-container *ngIf="serving.isSelected && !isReadOnly">
                <app-serving-quantity-input
                  [value]="serving.effectiveQuantity || 1"
                  [step]="1"
                  [min]="0.1"
                  [max]="999"
                  [disabled]="isReadOnly"
                  [ariaLabel]="'Quantity for ' + (serving.unitText || '')"
                  (click)="$event.stopPropagation(); onRowClicked(serving)"
                  (valueChange)="onServingQuantityChanged(serving, $event)">
                </app-serving-quantity-input>
                <span class="unit-label">{{ serving.unitText || '' }}</span>
              </ng-container>
              <!-- Show normal label for unselected rows or read-only mode -->
              <ng-container *ngIf="!serving.isSelected || isReadOnly">
                <span class="serving-label">{{ serving.servingLabel }}</span>
              </ng-container>
            </div>
          </ion-radio>
        </ion-radio-group>
      </div>
    </div>
  </div>
</div>