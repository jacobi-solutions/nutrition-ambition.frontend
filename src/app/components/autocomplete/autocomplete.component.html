<ng-select
  dropdownPosition="bottom" 
  [appendTo]="'body'"
  [clearable]="false"
  [searchable]="searchable"
  [searchFn]="customSearchFn"
  [loading]="loading"
  [ngModel]="internalValue"
  [closeOnSelect]="true"
  (ngModelChange)="onSelectionChange($event)"
  (search)="onSearch($event)"
  (clear)="onClear()"
  (focus)="onFocus()"
  (blur)="onBlur()"
  (open)="onOpen()"
  (close)="onClose()">

  <!-- Custom label template to show currentDisplayText -->
  <ng-template ng-label-tmp let-item="item">
    <span>{{ currentDisplayText || placeholder }}</span>
  </ng-template>

  <!-- Custom option template for displaying complex objects -->
  <ng-container *ngFor="let displayItem of displayItems; trackBy: trackByDisplayItem">
    <ng-option
      *ngIf="displayItem.showInDropdown"
      [value]="displayItem.value"
      [disabled]="displayItem.disabled"
>

      <!-- 2-column layout: photo + content -->
      <div class="option-layout">
        <!-- Left column: Photo -->
        <div class="option-photo">
          <img
            *ngIf="displayItem.value?.photoThumb"
            [src]="displayItem.value.photoThumb"
            [alt]="displayItem.displayName || displayItem.name || 'Food photo'"
            class="food-thumbnail"
            loading="lazy">
          <div
            *ngIf="!displayItem.value?.photoThumb"
            class="food-thumbnail-placeholder">
            üçΩÔ∏è
          </div>
        </div>

        <!-- Right column: Text content -->
        <div class="option-content">
          <!-- If item has displayName and brandName (like food items) -->
          <ng-container *ngIf="displayItem.hasDisplayName && displayItem.hasBrandName">
            <div class="option-name">{{ displayItem.displayName }}</div>
            <div class="option-brand">‚Äì {{ displayItem.brandName }}</div>
          </ng-container>

          <!-- If item has name and brand properties -->
          <ng-container *ngIf="!displayItem.hasDisplayName && displayItem.hasName && displayItem.hasBrand">
            <div class="option-name">{{ displayItem.name }}</div>
            <div class="option-brand">‚Äì {{ displayItem.brand }}</div>
          </ng-container>

          <!-- Everything else - use cleanDisplayText -->
          <div *ngIf="(!displayItem.hasDisplayName || !displayItem.hasBrandName) && (!displayItem.hasName || !displayItem.hasBrand)" class="option-name">
            {{ displayItem.cleanDisplayText }}
          </div>
        </div>
      </div>

    </ng-option>
  </ng-container>

  <!-- Loading template -->
  <ng-option
    *ngIf="loading"
    value="loading"
    [disabled]="true"
    class="loading-option">
    <span class="loading-text">Loading...</span>
  </ng-option>

  <!-- No items found template -->
  <ng-option
    *ngIf="!loading && items.length === 0"
    value="no-items"
    [disabled]="true"
    class="no-items-option">
    <span class="no-items-text">No items found</span>
  </ng-option>
</ng-select>