<ion-grid *ngIf="hasData">
  <ion-row>
    <!-- Calories Bar Chart -->
    <ion-col size="5">
      <div class="chart-wrapper">
        
        <div class="bar-chart">
          <div class="bar-group">
            <div class="bar consumed-bar" [style.height.%]="caloriesPercentage"></div>
            <span class="bar-label">Consumed</span>
          </div>
          <div class="bar-group" *ngIf="caloriesTarget > 0">
            <div class="bar target-bar" [style.height.%]="targetPercentage"></div>
            <span class="bar-label">Target</span>
          </div>
        </div>
        <div class="chart-values">
          <div class="value-item">
            <span class="value-label">Consumed:</span>
            <span class="value-number">{{ calories }} kcal</span>
          </div>
          <div class="value-item" *ngIf="caloriesTarget > 0">
            <span class="value-label">Target:</span>
            <span class="value-number">{{ caloriesTarget }} kcal</span>
          </div>
        </div>
      </div>
    </ion-col>

    <!-- Macro Distribution Donut Chart -->
    <ion-col size="7">
      <div class="chart-wrapper">
        <div class="donut-chart">
          <svg viewBox="-10 -10 120 120">
            <!-- Outer target ring (thinner, lighter) -->
            <circle class="donut-target-outer protein-target-outer" cx="50" cy="50" r="42"
                    [attr.stroke-dasharray]="proteinTargetPercentage * 2.64 + ' ' + 264"
                    [attr.stroke-dashoffset]="0"></circle>
            <circle class="donut-target-outer fat-target-outer" cx="50" cy="50" r="42"
                    [attr.stroke-dasharray]="fatTargetPercentage * 2.64 + ' ' + 264"
                    [attr.stroke-dashoffset]="-proteinTargetPercentage * 2.64"></circle>
            <circle class="donut-target-outer carbs-target-outer" cx="50" cy="50" r="42"
                    [attr.stroke-dasharray]="carbsTargetPercentage * 2.64 + ' ' + 264"
                    [attr.stroke-dashoffset]="-(proteinTargetPercentage + fatTargetPercentage) * 2.64"></circle>

            <!-- Middle actual consumption ring -->
            <circle class="donut-segment protein-segment" cx="50" cy="50" r="30"
                    [attr.stroke-dasharray]="proteinPercentage * 1.885 + ' ' + 188.5"
                    [attr.stroke-dashoffset]="0"></circle>
            <circle class="donut-segment fat-segment" cx="50" cy="50" r="30"
                    [attr.stroke-dasharray]="fatPercentage * 1.885 + ' ' + 188.5"
                    [attr.stroke-dashoffset]="-proteinPercentage * 1.885"></circle>
            <circle class="donut-segment carbs-segment" cx="50" cy="50" r="30"
                    [attr.stroke-dasharray]="carbsPercentage * 1.885 + ' ' + 188.5"
                    [attr.stroke-dashoffset]="-(proteinPercentage + fatPercentage) * 1.885"></circle>

            <!-- Inner target ring (thinner, lighter) -->
            <circle class="donut-target-inner protein-target-inner" cx="50" cy="50" r="16.5"
                    [attr.stroke-dasharray]="proteinTargetPercentage * 1.037 + ' ' + 103.7"
                    [attr.stroke-dashoffset]="0"></circle>
            <circle class="donut-target-inner fat-target-inner" cx="50" cy="50" r="16.5"
                    [attr.stroke-dasharray]="fatTargetPercentage * 1.037 + ' ' + 103.7"
                    [attr.stroke-dashoffset]="-proteinTargetPercentage * 1.037"></circle>
            <circle class="donut-target-inner carbs-target-inner" cx="50" cy="50" r="16.5"
                    [attr.stroke-dasharray]="carbsTargetPercentage * 1.037 + ' ' + 103.7"
                    [attr.stroke-dashoffset]="-(proteinTargetPercentage + fatTargetPercentage) * 1.037"></circle>

            <!-- Actual percentage labels (white, on middle ring) -->
            <text class="percentage-label protein-label" [attr.x]="proteinLabelX" [attr.y]="proteinLabelY" text-anchor="middle" dominant-baseline="middle" [attr.transform]="'rotate(' + proteinLabelRotation + ', ' + proteinLabelX + ', ' + proteinLabelY + ')'">{{ proteinPercentage }}%</text>
            <text class="percentage-label fat-label" [attr.x]="fatLabelX" [attr.y]="fatLabelY" text-anchor="middle" dominant-baseline="middle" [attr.transform]="'rotate(' + fatLabelRotation + ', ' + fatLabelX + ', ' + fatLabelY + ')'">{{ fatPercentage }}%</text>
            <text class="percentage-label carbs-label" [attr.x]="carbsLabelX" [attr.y]="carbsLabelY" text-anchor="middle" dominant-baseline="middle" [attr.transform]="'rotate(' + carbsLabelRotation + ', ' + carbsLabelX + ', ' + carbsLabelY + ')'">{{ carbsPercentage }}%</text>

            <!-- Target percentage labels (black, outside outer ring) -->
            <text class="target-percentage-label protein-target-label" [attr.x]="proteinTargetLabelX" [attr.y]="proteinTargetLabelY" text-anchor="middle" dominant-baseline="central" [attr.transform]="'rotate(' + proteinTargetLabelRotation + ', ' + proteinTargetLabelX + ', ' + proteinTargetLabelY + ')'">{{ proteinTargetPercentage }}%</text>
            <text class="target-percentage-label fat-target-label" [attr.x]="fatTargetLabelX" [attr.y]="fatTargetLabelY" text-anchor="middle" dominant-baseline="central" [attr.transform]="'rotate(' + fatTargetLabelRotation + ', ' + fatTargetLabelX + ', ' + fatTargetLabelY + ')'">{{ fatTargetPercentage }}%</text>
            <text class="target-percentage-label carbs-target-label" [attr.x]="carbsTargetLabelX" [attr.y]="carbsTargetLabelY" text-anchor="middle" dominant-baseline="central" [attr.transform]="'rotate(' + carbsTargetLabelRotation + ', ' + carbsTargetLabelX + ', ' + carbsTargetLabelY + ')'">{{ carbsTargetPercentage }}%</text>
          </svg>
        </div>
        <div class="chart-values">
          <div class="value-item">
            <span class="value-dot protein-dot"></span>
            <span class="value-label">Protein:</span>
            <span class="value-number">{{ proteinGrams }}g / {{ proteinTargetGrams }}g</span>
          </div>
          <div class="value-item">
            <span class="value-dot fat-dot"></span>
            <span class="value-label">Fat:</span>
            <span class="value-number">{{ fatGrams }}g / {{ fatTargetGrams }}g</span>
          </div>
          <div class="value-item">
            <span class="value-dot carbs-dot"></span>
            <span class="value-label">Carbs:</span>
            <span class="value-number">{{ carbsGrams }}g / {{ carbsTargetGrams }}g</span>
          </div>
        </div>
      </div>
    </ion-col>
  </ion-row>
</ion-grid>

<!-- Empty state -->
<div class="empty-state" *ngIf="!hasData">
  <span>No macronutrient data available</span>
</div>
